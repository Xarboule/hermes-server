<!DOCTYPE html>
<html>
<body>

<p>Hermes<br></p>

<button  name="fbutton" id="fbutton">Avant</button><br>
<button  name="lbutton" id="lbutton">Gauche</button>
<button  onclick="stop()">Stop</button>
<button  name="rbutton" id="rbutton">Droite</button><br>
<button  name="bbutton" id="bbutton" >Arrière</button>
<br>
<br>
<br>
<button onclick="shutdown()">Fin du pilotage</button>



<p id="speed">Arrêt</p>
<p id="turn">Tout droit</p>

<script>
    function moveForward() {
        document.getElementById("speed").innerHTML = "Marche avant";
        sendEvent("go");
    }

    function moveBackward() {
        document.getElementById("speed").innerHTML = "Marche arrière";
        sendEvent("gor");

    }

    function turnLeft() {
        document.getElementById("turn").innerHTML = "Tourne à gauche";
        sendEvent("sweepL");
    }

    function turnRight() {
        document.getElementById("turn").innerHTML = "Tourne à droite";
        sendEvent("sweepR");
    }

    function stop() {
        document.getElementById("speed").innerHTML = "Arrêt";
        sendEvent("stop");
    }

    function sweepStop () {
        document.getElementById("turn").innerHTML = "Arrete de tourner"
        sendEvent("sweepstop");
    }

    var isPressedfbutton = false;
    var isPressedbbutton = false;
    var isPressedlbutton = false;
    var isPressedrbutton = false;

    var keepaliveTime = 400;
    var keepAlive = setInterval(stop, keepaliveTime);

    function keyDown(event) {
        event.stopPropagation();

        if (event.keyCode === 38 && !isPressedfbutton){
            isPressedfbutton = true;
            clearInterval(keepAlive);
            keepAlive = setInterval(moveForward, keepaliveTime);
            moveForward();
        } // avant

        else if (event.keyCode === 40 && !isPressedbbutton){
            isPressedbbutton = true;
            clearInterval(keepAlive);
            keepAlive = setInterval(moveBackward, keepaliveTime);
            moveBackward();
        } //arriere

        else if (event.keyCode === 37 && !isPressedlbutton) {
            isPressedlbutton = true;
            turnLeft();
        } //gauche

        else if (event.keyCode === 39 && !isPressedrbutton) {
            isPressedrbutton = true;
            turnRight();

        } //droite
    }

    function keyUp(event) {

        if (event.keyCode === 38){
            stop();
            clearInterval(keepAlive);
            keepAlive = setInterval(stop, keepaliveTime);
            isPressedfbutton = false;
        }
    else if (event.keyCode === 40){
            stop();
            clearInterval(keepAlive);
            keepAlive = setInterval(stop, keepaliveTime);
            isPressedbbutton = false;
        }
        else if (event.keyCode === 37){
            sweepStop();
            isPressedlbutton = false;
        }
        else if (event.keyCode === 39){
            sweepStop();
            isPressedrbutton = false;

        }
    }

    function sendEvent(string) {
        var http = new XMLHttpRequest();
        var url = "remote";
        var params = "orderstr="+string;
        http.open("POST", url, true);
        console.log('Création de la requete http...');

//Send the proper header information along with the request
        http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

        http.onreadystatechange = function() {//Call a function when the state changes.
            if(http.readyState == 4 && http.status == 200) {
                console.log('Le serveur a recu un ordre '+string);
            }

        }
        http.send(params);
    }


    var fbutton = document.getElementById('fbutton');
    var bbutton = document.getElementById('bbutton');
    var rbutton = document.getElementById('rbutton');
    var lbutton = document.getElementById('lbutton');

    fbutton.addEventListener('mousedown', moveForward);
    bbutton.addEventListener('mousedown', moveBackward);
    rbutton.addEventListener('mousedown', turnRight);
    lbutton.addEventListener('mousedown', turnLeft);

    fbutton.addEventListener('mouseup', stop);
    bbutton.addEventListener('mouseup', stop);
    rbutton.addEventListener('mouseup', stop);
    lbutton.addEventListener('mouseup', stop);

    document.addEventListener('keydown', keyDown);
    document.addEventListener('keyup', keyUp);


    // Gestion de fermeture de fenetre







</script>

</body>
</html>